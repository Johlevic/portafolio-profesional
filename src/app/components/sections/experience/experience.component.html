<section
  class="py-16 lg:py-24 px-0 max-w-3xl mx-auto text-gray-800 dark:text-gray-200 transition-colors duration-300"
>
  <div #headerRef>
    <h2
      class="text-4xl lg:text-5xl font-bold text-center text-blue-600 dark:text-blue-400 mb-4"
    >
      {{ languageService.t("experience.title") }}
    </h2>
    <p
      class="text-lg md:text-xl text-center mb-12 text-gray-600 dark:text-gray-400"
    >
      {{ languageService.t("experience.subtitle") }}
    </p>
  </div>

  <div class="relative flex flex-col items-start px-2 md:px-0">
    <!-- Removed global timeline line -->

    <article
      #timelineItem
      *ngFor="let exp of experiences; let i = index; let last = last"
      [attr.data-index]="i"
      class="relative flex items-start gap-4 mb-12 w-full transition-all duration-700 opacity-0 transform translate-y-10"
      [class.opacity-100]="exp.isVisible"
      [class.translate-y-0]="exp.isVisible"
    >
      <!-- Timeline Line (Interrupted) -->
      <!-- Only show if not the last item -->
      <div
        *ngIf="!last"
        class="absolute left-[19px] top-10 w-0.5 h-full bg-gray-200 dark:bg-gray-800 -z-10"
      >
        <!-- Animated Blue Line Overlay -->
        <div
          class="w-full bg-blue-600 transition-all duration-1000 delay-500 ease-out origin-top"
          [style.height.%]="exp.isVisible ? 100 : 0"
        ></div>
      </div>

      <div
        class="relative z-10 flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg border-2 transition-all duration-700 scale-0"
        [class.scale-100]="exp.isVisible"
        [ngClass]="
          exp.isVisible
            ? 'bg-blue-600 border-blue-400 text-white'
            : 'bg-gray-200 dark:bg-gray-800 text-gray-400'
        "
      >
        <i class="bi bi-briefcase"></i>
      </div>

      <div
        class="flex-grow bg-white dark:bg-gray-800 border border-gray-200 dark:border-blue-500/20 rounded-2xl p-6 shadow-xl transition-all duration-500"
      >
        <div class="flex justify-between items-start mb-2">
          <div>
            <h3 class="text-gray-900 dark:text-white text-xl font-bold">
              {{ languageService.t(exp.role) }}
            </h3>
            <p class="text-blue-600 dark:text-blue-400 font-semibold">
              {{ languageService.t(exp.company) }}
            </p>
          </div>
        </div>

        <div
          class="flex flex-wrap gap-4 mb-6 text-gray-500 dark:text-gray-400 text-sm"
        >
          <span
            ><i class="bi bi-calendar3"></i>
            {{ languageService.t(exp.duration) }}</span
          >
          <span
            ><i class="bi bi-geo-alt-fill"></i>
            {{ languageService.t(exp.location) }}</span
          >
        </div>

        <ul
          class="space-y-3 text-sm text-gray-700 dark:text-gray-300 border-l-2 border-gray-100 pl-4 overflow-hidden transition-all duration-500"
          [style.max-height]="isDesktop || exp.isExpanded ? '1000px' : '85px'"
          *ngIf="exp.responsibilities.length > 0"
        >
          <li *ngFor="let resp of exp.responsibilities">
            {{ languageService.t(resp) }}
          </li>
        </ul>

        <button
          class="mt-4 flex items-center gap-2 text-blue-600 dark:text-blue-400 font-bold md:hidden"
          *ngIf="exp.responsibilities.length > 0"
          (click)="toggleExpand(exp)"
        >
          {{
            exp.isExpanded
              ? languageService.t("experience.viewLess")
              : languageService.t("experience.viewMore")
          }}
        </button>
      </div>
    </article>
  </div>

  <!-- STICKY TITLE TEMPLATE -->
  <ng-template #stickyTitleTemplate>
    <div
      class="flex items-center px-4 py-2 rounded-full bg-white/80 dark:bg-gray-900/80 backdrop-blur-md shadow-lg border border-gray-200 dark:border-gray-700/50 animate-fade-in"
    >
      <span
        class="text-sm font-bold bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 text-transparent bg-clip-text"
      >
        {{ languageService.t("experience.title") }}
      </span>
    </div>
  </ng-template>
</section>
